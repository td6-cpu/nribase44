import React, { useState, useEffect, useRef } from "react";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { motion } from "framer-motion";
import { 
  TrendingUp, 
  Globe, 
  Target, 
  Shield, 
  Network,
  DollarSign,
  Users,
  Zap,
  BarChart3,
  FileText
} from "lucide-react";

import ExecutiveSummary from "../components/business-plan/ExecutiveSummary";
import MarketOpportunity from "../components/business-plan/MarketOpportunity";
import MarketCatalyst from "../components/business-plan/MarketCatalyst";
import DomainPortfolio from "../components/business-plan/DomainPortfolio";
import StrategicMoats from "../components/business-plan/StrategicMoats";
import BusinessModel from "../components/business-plan/BusinessModel";
import CompetitiveAnalysis from "../components/business-plan/CompetitiveAnalysis";
import GTMStrategy from "../components/business-plan/GTMStrategy";

export default function BusinessPlan() {
  const [activeSection, setActiveSection] = useState("executive");
  const executiveRef = useRef(null);
  const marketRef = useRef(null);
  const catalystRef = useRef(null);
  const domainsRef = useRef(null);
  const moatsRef = useRef(null);
  const businessModelRef = useRef(null);
  const competitiveRef = useRef(null);
  const gtmRef = useRef(null);

  useEffect(() => {
    const sectionsList = [
      { id: "executive", ref: executiveRef },
      { id: "market", ref: marketRef },
      { id: "catalyst", ref: catalystRef },
      { id: "domains", ref: domainsRef },
      { id: "moats", ref: moatsRef },
      { id: "business", ref: businessModelRef },
      { id: "competitive", ref: competitiveRef },
      { id: "gtm", ref: gtmRef },
    ];

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            setActiveSection(entry.target.id);
          }
        });
      },
      { threshold: 0.2 }
    );

    sectionsList.forEach((section) => {
      if (section.ref.current) {
        observer.observe(section.ref.current);
      }
    });

    return () => observer.disconnect();
  }, []);

  const sections = [
    { id: "executive", label: "Executive Summary", icon: Target, ref: executiveRef },
    { id: "market", label: "Market Opportunity", icon: Globe, ref: marketRef },
    { id: "catalyst", label: "Market Catalyst", icon: TrendingUp, ref: catalystRef },
    { id: "domains", label: "24 Domains", icon: Network, ref: domainsRef },
    { id: "moats", label: "Strategic Moats", icon: Shield, ref: moatsRef },
    { id: "business", label: "Business Model", icon: DollarSign, ref: businessModelRef },
    { id: "competitive", label: "Competition", icon: BarChart3, ref: competitiveRef },
    { id: "gtm", label: "Go-to-Market", icon: Zap, ref: gtmRef },
  ];

  const scrollToSection = (ref) => {
    ref?.current?.scrollIntoView({ 
      behavior: "smooth",
      block: "start"
    });
  };

  return (
    <div className="min-h-screen bg-gradient-to-b from-slate-50 to-slate-100">
      {/* Hero Section */}
      <div className="gradient-bg text-white py-20 px-6">
        <div className="max-w-7xl mx-auto">
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.6 }}
          >
            <Badge className="mb-6 bg-amber-500 text-white border-none px-4 py-2 text-sm">
              Version 3.0 | October 2025 | Internal Review Document
            </Badge>
            <h1 className="text-6xl font-bold mb-6 leading-tight">
              nri.my Strategic Business Plan
            </h1>
            <p className="text-2xl text-slate-300 max-w-4xl leading-relaxed">
              Integrated NRI Services Platform - Connecting 32+ Million Non-Resident Indians 
              with Comprehensive Cross-Border Services Across 24 Specialized Domains
            </p>
            <div className="flex gap-4 mt-8">
              <div className="bg-white/10 backdrop-blur-sm rounded-lg px-6 py-4">
                <p className="text-slate-300 text-sm">Market Size</p>
                <p className="text-3xl font-bold">32M+ NRIs</p>
              </div>
              <div className="bg-white/10 backdrop-blur-sm rounded-lg px-6 py-4">
                <p className="text-slate-300 text-sm">Service Domains</p>
                <p className="text-3xl font-bold">24</p>
              </div>
              <div className="bg-white/10 backdrop-blur-sm rounded-lg px-6 py-4">
                <p className="text-slate-300 text-sm">Strategic Verticals</p>
                <p className="text-3xl font-bold">7</p>
              </div>
            </div>
          </motion.div>
        </div>
      </div>

      {/* Sticky Navigation */}
      <div className="sticky top-0 z-50 bg-white/95 backdrop-blur-sm border-b border-slate-200 shadow-lg">
        <div className="max-w-7xl mx-auto px-6">
          <div className="flex gap-1 overflow-x-auto py-3 scrollbar-hide">
            {sections.map((section) => {
              const Icon = section.icon;
              return (
                <Button
                  key={section.id}
                  variant={activeSection === section.id ? "default" : "ghost"}
                  size="sm"
                  className={`flex items-center gap-2 whitespace-nowrap transition-all ${
                    activeSection === section.id 
                      ? "bg-slate-900 text-white shadow-md" 
                      : "text-slate-600 hover:text-slate-900 hover:bg-slate-100"
                  }`}
                  onClick={() => scrollToSection(section.ref)}
                >
                  <Icon className="w-4 h-4" />
                  <span className="hidden sm:inline">{section.label}</span>
                </Button>
              );
            })}
          </div>
        </div>
      </div>

      {/* Content Sections */}
      <div className="max-w-7xl mx-auto px-6 py-16 space-y-24">
        <div id="executive" ref={executiveRef}>
          <ExecutiveSummary />
        </div>

        <div id="market" ref={marketRef}>
          <MarketOpportunity />
        </div>

        <div id="catalyst" ref={catalystRef}>
          <MarketCatalyst />
        </div>

        <div id="domains" ref={domainsRef}>
          <DomainPortfolio />
        </div>

        <div id="moats" ref={moatsRef}>
          <StrategicMoats />
        </div>

        <div id="business" ref={businessModelRef}>
          <BusinessModel />
        </div>

        <div id="competitive" ref={competitiveRef}>
          <CompetitiveAnalysis />
        </div>

        <div id="gtm" ref={gtmRef}>
          <GTMStrategy />
        </div>
      </div>

      {/* Footer */}
      <div className="gradient-bg text-white py-12 px-6 mt-24">
        <div className="max-w-7xl mx-auto text-center">
          <p className="text-slate-300 text-lg">
            nri.my - Integrated NRI Services Platform
          </p>
          <p className="text-slate-400 text-sm mt-2">
            Strategic Business Plan v3.0 | Confidential & Proprietary
          </p>
        </div>
      </div>
    </div>
  );
}
